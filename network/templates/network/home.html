{% extends 'network/base.html' %}
{% load static %}

{% block title %}–ì–æ–ª–æ–≤–Ω–∞ - WanderNet{% endblock %}

{% block content %}
<h2 class="feed-title">–°—Ç—Ä—ñ—á–∫–∞ –º–∞–Ω–¥—Ä—ñ–≤–Ω–∏–∫—ñ–≤</h2>

<div class="post-feed">
    {% for post in posts %}
        <div class="post-card">
            <div class="post-header">
                <strong>@{{ post.user.username }}</strong>
                <span class="post-date">{{ post.created_at|date:"d.m.Y H:i" }}</span>
            </div>

            <p class="post-caption">{{ post.caption }}</p>

            {% if post.image %}
                <div class="post-image">
                    <img src="{{ post.image.url }}" alt="–§–æ—Ç–æ –ø–æ–¥–æ—Ä–æ–∂—ñ">
                </div>
            {% endif %}

            <form method="post" action="{% url 'like_post' post.id %}" class="like-form">
                {% csrf_token %}
                <button type="submit" class="like-button">‚ù§Ô∏è {{ post.likes.count }}</button>
            </form>

     <div class="comments-section">
    <button class="toggle-comments-btn btn btn-sm btn-outline-primary mb-2" type="button">
        üí¨ –ü–æ–∫–∞–∑–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ ({{ post.comments.count }})
    </button>

    <div class="comments-container" style="display: none;">
        <div class="comments">
            {% for comment in post.comments.all %}
                <div class="comment">
                    <strong>{{ comment.user.username }}</strong>:
                    <span>{{ comment.content }}</span>
                    <small class="comment-date">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                </div>
            {% empty %}
                <p class="no-comments">–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤.</p>
            {% endfor %}
        </div>

        {% if user.is_authenticated %}
            <form method="post" class="comment-form" data-post-id="{{ post.id }}">
                {% csrf_token %}
                <textarea name="content" rows="2" class="form-control" placeholder="–ó–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä..."></textarea>
                <input type="hidden" name="comment_post_id" value="{{ post.id }}">
                <button type="submit" class="btn btn-outline-success btn-sm mt-1">–î–æ–¥–∞—Ç–∏</button>
            </form>
        {% else %}
            <p class="login-comment">–©–æ–± –∫–æ–º–µ–Ω—Ç—É–≤–∞—Ç–∏, <a href="{% url 'login' %}">—É–≤—ñ–π–¥—ñ—Ç—å</a>.</p>
        {% endif %}
    </div>
</div>

        </div>
    {% empty %}
        <p class="no-posts">–ù–∞—Ä–∞–∑—ñ –Ω–µ–º–∞—î –ø–æ—Å—Ç—ñ–≤.</p>
    {% endfor %}
</div>
{% endblock %}
